// WebSocket Hook - 监控WebSocket通信
(function() {
    const OriginalWebSocket = window.WebSocket;

    window.WebSocket = function(url, protocols) {
        console.log('[WebSocket Connect]', url);

        const ws = protocols ? new OriginalWebSocket(url, protocols) : new OriginalWebSocket(url);

        // Hook send
        const originalSend = ws.send.bind(ws);
        ws.send = function(data) {
            console.log('[WebSocket Send]', data);
            return originalSend(data);
        };

        // Hook onmessage
        ws.addEventListener('message', function(event) {
            console.log('[WebSocket Recv]', event.data);
        });

        ws.addEventListener('open', function() {
            console.log('[WebSocket Open]', url);
        });

        ws.addEventListener('close', function(event) {
            console.log('[WebSocket Close]', event.code, event.reason);
        });

        ws.addEventListener('error', function(event) {
            console.log('[WebSocket Error]', event);
        });

        return ws;
    };

    window.WebSocket.prototype = OriginalWebSocket.prototype;
    window.WebSocket.CONNECTING = OriginalWebSocket.CONNECTING;
    window.WebSocket.OPEN = OriginalWebSocket.OPEN;
    window.WebSocket.CLOSING = OriginalWebSocket.CLOSING;
    window.WebSocket.CLOSED = OriginalWebSocket.CLOSED;

    console.log('[Hook] WebSocket Hook 已注入');
})();
