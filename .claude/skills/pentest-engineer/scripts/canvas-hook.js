// Canvas Hook - 监控Canvas指纹采集
(function() {
    // toDataURL Hook
    const originalToDataURL = HTMLCanvasElement.prototype.toDataURL;
    HTMLCanvasElement.prototype.toDataURL = function(type, quality) {
        console.log('[Canvas toDataURL]', type, this.width, 'x', this.height);
        // 可返回固定值绑过指纹检测
        // return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';
        return originalToDataURL.apply(this, arguments);
    };

    // getImageData Hook
    const originalGetImageData = CanvasRenderingContext2D.prototype.getImageData;
    CanvasRenderingContext2D.prototype.getImageData = function(sx, sy, sw, sh) {
        console.log('[Canvas getImageData]', sx, sy, sw, sh);
        return originalGetImageData.apply(this, arguments);
    };

    // WebGL指纹
    const getParameterProto = WebGLRenderingContext.prototype.getParameter;
    WebGLRenderingContext.prototype.getParameter = function(parameter) {
        // 常见指纹参数: VENDOR, RENDERER
        if (parameter === 37445 || parameter === 37446) {
            console.log('[WebGL getParameter]', parameter);
        }
        return getParameterProto.apply(this, arguments);
    };

    console.log('[Hook] Canvas Hook 已注入');
})();
