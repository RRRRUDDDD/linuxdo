# 反调试技术详解

## 常见反调试手段

### 1. 无限debugger
```javascript
// 定时器触发
setInterval(function(){debugger;}, 1000)

// eval执行
eval("debugger")

// Function构造
(function(){return function(){debugger}})()()
```

**绕过方法：**
- 条件断点设置为 `false`
- 使用 `debugger-hook.js` 脚本
- 右键断点选择 "Never pause here"

### 2. 控制台检测
```javascript
// 检测控制台打开
var devtools = /./;
devtools.toString = function() {
    this.opened = true;
}
console.log('%c', devtools);

// 窗口大小检测
if (window.outerWidth - window.innerWidth > 160) {
    // 控制台已打开
}
```

**绕过方法：**
- Hook console方法
- 使用独立窗口打开DevTools
- 修改window尺寸相关属性

### 3. 代码完整性检测
```javascript
// 函数toString检测
function check() {
    if (check.toString().indexOf('debugger') === -1) {
        // 被修改
    }
}
```

**绕过方法：**
- Hook Function.prototype.toString
- 保持原函数签名

### 4. 时间差检测
```javascript
var start = Date.now();
debugger;
if (Date.now() - start > 100) {
    // 检测到调试
}
```

**绕过方法：**
- Hook Date.now/performance.now
- 快速跳过断点

## 调试技巧

### 条件断点
在断点上右键设置条件：
- `false` - 永不暂停
- `console.log(变量)` - 打印但不暂停
- `变量 === '特定值'` - 条件触发

### 日志断点
右键断点 → "Edit breakpoint" → 勾选 "Log message"

### DOM断点
Elements面板 → 右键元素 → Break on:
- subtree modifications
- attribute modifications
- node removal

### XHR断点
Sources面板 → XHR/fetch Breakpoints → 添加URL关键词

### 事件监听断点
Sources面板 → Event Listener Breakpoints → 勾选事件类型

## 实用命令

```javascript
// 查找所有事件监听器
getEventListeners(document)

// 监控函数调用
monitor(functionName)

// 监控对象属性访问
Object.defineProperty(obj, 'prop', {
    get: function() { debugger; return this._prop; },
    set: function(v) { debugger; this._prop = v; }
})
```
