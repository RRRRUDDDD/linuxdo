# 主流JS安全产品分析

## 瑞数动态安全

**特征识别：**
- Cookie名：`FSSBBIl1UgzbN7N80S`, `FSSBBIl1UgzbN7N80T`
- 全局变量：`$_ts`, `$_zw`
- 混淆特征：大量数组索引访问、字符串拼接

**分析要点：**
1. 入口定位：搜索Cookie设置位置
2. 核心逻辑：`$_ts` 对象的各个方法
3. 环境检测：window、document、navigator属性检测
4. 动态生成：每次请求Cookie值变化

**应对策略：**
- 补环境：模拟完整浏览器环境
- RPC调用：浏览器执行，远程获取结果
- 算法还原：分析核心加密逻辑

## 加速乐

**特征识别：**
- Cookie名：`__jsluid_s`, `__jsl_clearance_s`
- 响应特征：521状态码，返回JS代码
- 多次验证：通常需要2-3次请求

**分析要点：**
1. 第一次请求：获取混淆JS
2. 执行JS：生成Cookie
3. 携带Cookie重新请求

**应对策略：**
- 直接执行返回的JS代码
- 提取Cookie生成逻辑

## 创宇盾

**特征识别：**
- Cookie名：`HWWAFSESID`, `HWWAFSESTIME`
- 请求头：特定User-Agent检测
- JS验证：首次访问返回JS挑战

**应对策略：**
- 执行JS挑战代码
- 保持Session一致性

## 极验验证码

**特征识别：**
- 滑块验证：`geetest_`前缀
- 参数：`gt`, `challenge`, `w`
- 轨迹加密：`w`参数包含加密轨迹

**分析要点：**
1. `w`参数生成：轨迹数据+时间戳+随机值
2. 轨迹格式：`[[x,y,t],...]`
3. RSA加密：公钥加密轨迹数据

## 通用分析流程

1. **抓包分析**
   - 识别关键请求参数
   - 追踪Cookie变化

2. **代码定位**
   - 搜索参数名/Cookie名
   - XHR断点拦截

3. **逻辑分析**
   - 反混淆处理
   - 提取核心算法

4. **环境模拟**
   - 补全浏览器环境
   - 处理检测点

5. **验证测试**
   - 对比原始请求
   - 多次测试稳定性

## AST还原技巧

```javascript
// 常见混淆模式
// 1. 字符串数组
var _0x1234 = ['log', 'hello'];
console[_0x1234[0]](_0x1234[1]);
// 还原：console.log('hello')

// 2. 控制流平坦化
switch(state) {
    case '1': /*code1*/ state='3'; break;
    case '2': /*code2*/ state='end'; break;
    case '3': /*code3*/ state='2'; break;
}
// 还原：按执行顺序重排代码
```

**推荐工具：**
- AST Explorer: https://astexplorer.net
- Babel: 编写还原插件
- 在线反混淆工具
